<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Configurar Sala — Questions Multiplayer</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <main class="centered-card large">
    <header class="card-header">
      <h1>Configurar Sala</h1>
      <p class="subtitle">Ajuste as regras antes de começar.</p>
    </header>

    <section class="card-body">
      <div class="form-row">
        <label>Sala</label>
        <input id="roomName" disabled />
      </div>

      <div class="form-row">
        <label>Senha</label>
        <input id="roomPassword" disabled />
      </div>

      <hr />

      <div class="form-row">
        <label for="questionCount">Quantidade de perguntas</label>
        <select id="questionCount">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </div>

      <div class="form-row">
        <label for="timeLimit">Tempo por pergunta (segundos)</label>
        <select id="timeLimit">
          <option value="10">10</option>
          <option value="15">15</option>
          <option value="20" selected>20</option>
          <option value="30">30</option>
        </select>
      </div>

      <div class="form-row">
        <label>Modo</label>
        <select id="mode">
          <option value="normal" selected>Normal</option>
          <option value="hard">Difícil</option>
          <option value="chaos">Caótico</option>
        </select>
      </div>

      <div class="form-row">
        <label>Privacidade</label>
        <select id="privacy">
          <option value="private" selected>Privada (senha obrigatória)</option>
          <option value="public">Pública</option>
        </select>
      </div>

      <hr />

      <button id="btn-start" class="btn primary full">Iniciar Jogo</button>
      <button id="btn-back" class="btn ghost full">Voltar</button>
    </section>

    <footer class="card-footer">
      <small>Configurações aplicam apenas para esta sala</small>
    </footer>
  </main>

  <script>
    // Ler params seguros via sessionStorage
    function readNavParams(path){
      const key = `nav:${path}`;
      const raw = sessionStorage.getItem(key);
      if(!raw) return null;
      try { return JSON.parse(raw); } catch(e){ return null; }
    }

    const nav = readNavParams('/config.html') || {};
    const room = nav.room || '';
    const password = nav.password || '';
    const isHost = !!nav.host;

    document.getElementById('roomName').value = room;
    document.getElementById('roomPassword').value = password;

    if(!isHost){
      alert('Apenas o criador da sala pode configurar.');
      location.href = '/index.html';
    }

    document.getElementById('btn-start').addEventListener('click', ()=> {
      // store config into session storage and go to game
      const cfg = {
        questions: +document.getElementById('questionCount').value,
        time: +document.getElementById('timeLimit').value,
        mode: document.getElementById('mode').value,
        privacy: document.getElementById('privacy').value
      };
      // save to sessionStorage keyed to room (not exposing password in URL)
      sessionStorage.setItem(`roomcfg:${room}`, JSON.stringify(cfg));

      // pass nav params to game
      sessionStorage.setItem(`nav:/game.html`, JSON.stringify({ room, password, host: true }));
      location.href = '/game.html';
    });

    document.getElementById('btn-back').addEventListener('click', ()=> {
      location.href = '/index.html';
    });
  </script>
</body>
</html>
